<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/polymerfire/firebase-storage.html">

<link rel="import" href="shared-styles.html"></link>
<link rel="import" href="custom-icons.html"></link>

<dom-module id="main-app">
  <template>
    <style include="shared-styles">

      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      .drawer-list {
        margin: 0 20px;
      }

      .drawer-list a {
        display: block;
        padding: 0 16px;
        text-decoration: none;
        color: var(--app-secondary-color);
        line-height: 40px;
      }

      .drawer-list a.iron-selected {
        color: black;
        font-weight: bold;
      }

      a.header-option {
        padding: 2px 0px 2px 0px;
        color: #ffffff;
        font-size: 12px;
        float:right;
        width: 65%;
      }

      a.header-option:hover {
        text-decoration: underline;
      }

      div.header-option-group {
        float: right;
        margin-left: -25px;
      }

      a.drawer-option {

      }

      .header-icon {
        margin-top: 2px;
      }

    </style>

    <firebase-app
      name="19giap"
      auth-domain="giap-80ec2.firebaseapp.com"
      database-url="https://giap-80ec2.firebaseio.com"
      api-key="AIzaSyBvWg_JPft53Qn_-FaSpim-P9tNnjzJeus"
      storag-bucket="giap-80ec2.appspot.com">
    </firebase-app>
    <firebase-auth
      id="auth"
      user="{{user}}"
      signed-in="{{signedIn}}">
    </firebase-auth>

    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}">
    </app-route>

    <app-drawer-layout fullbleed>
      <!-- Drawer content -->
      <app-drawer>
        <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
          <a class="drawer-option" id="home" name="home" href="/home">Home</a>
          <a class="drawer-option" name="about" href="#">About Us</a>
          <a class="drawer-option" name="roster" href="/roster">Roster</a>
          <a class="drawer-option" name="forum" href="#">Forum</a>
          <a class="drawer-option" name="view-1" href="/view-1">View One</a>
          <a class="drawer-option" name="view-2" href="/view-2">View Two</a>
        </iron-selector>
      </app-drawer>

      <!-- Main content -->
      <app-header-layout has-scrolling-region>

        <app-header condenses reveals effects="waterfall">
          <app-toolbar>
            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
            <div main-title class="serif">19.GIAP</div>
            <spacer></spacer>
            <div hidden$="[[signedIn]]">
              <a href="/login" title="Sign In" tabindex="-1">
                <paper-icon-button class="header-icon" icon="icons:account-circle"></paper-icon-button>
              </a>
              <div class="header-option-group">
                <a class="header-option" href="/login" title="Sign In" tabindex="-1">Login</a>
                <a class="header-option" href="/register" title="Register" tabindex="-1">Register</a>
              </div>
            </div>
            <div hidden$="[[!signedIn]]">
              <a href="/login" title="Profile" tabindex="-1">
                <paper-icon-button class="header-icon" icon="icons:account-circle"></paper-icon-button>
              </a>
              <div class="header-option-group">
                <a class="header-option" href="#" title="Profile" tabindex="-1">{{user.email}}</a>
                <a class="header-option" title="Sign Out" tabindex="-1" on-tap="signOut">Sign Out</a>
              </div>
            </div>
          </app-toolbar>

        </app-header>

        <iron-pages
            selected="[[page]]"
            attr-for-selected="name"
            fallback-selection="error-404"
            role="main-app">
          <home-page id="home" name="home"></home-page>
          <login-page id="login" name="login"
              user="{{user}}" signed-in="{{signedIn}}"></login-page>
          <register-page id="register" name="register"
            user="{{user}}" signed-in="{{signedIn}}"></register-page>
          <roster-page id="roster" name="roster" route={{subroute}}></roster-page>
          <view-1 id="view1" signed-in="[[signedIn]]" name="view-1"></view-1>
          <view-2 name="view-2"></view-2>
          <error-404 name="error-404"></error-404>
        </iron-pages>
      </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
    Polymer({
      is: 'main-app',

      properties: {
        user: Object,
        signedIn: {
          type: Boolean,
          observer: '_signedInChanged',
          notify: true
        },
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        }
      },

      observers: [
        '_routePageChanged(routeData.page)'
      ],

      signOut: function() {
        console.log('sign out');
        this.$.auth.signOut().then(function() {
          console.log('signed out successfully');
        }, function(error) {
          console.log('sign out error');
          console.log(error);
        })
      },

      _signedInChanged: function(signedIn) {
        console.log('signedIn changed to ' + signedIn);
      },

      _routePageChanged: function(page) {
        this.page = page || 'home';
      },

      _pageChanged: function(page) {
        var resolvedPageUrl = this.resolveUrl(page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = 'error-404';
      }
    });
  </script>
</dom-module>
